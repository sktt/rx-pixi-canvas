!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("rx"),require("pixi.js")):"function"==typeof define&&define.amd?define(["rx","pixi.js"],e):t.canvasRenderer=e(t.Rx,t.PIXI)}(this,function(t,e){"use strict";function r(t,e){return e={exports:{}},t(e,e.exports),e.exports}function n(t,e){var r=function(t,e){return t.pos.dist(e.pos)},n=[],i=[t],o=new Map,s=new Map([[t,0]]),u=new Map([[t,r(t,e)]]);s.get=function(t){return s.has(t)?Map.prototype.get.call(s,t):1/0},u.get=function(t){return u.has(t)?Map.prototype.get.call(u,t):1/0};for(var h=function(){var t=i.sort(function(t,e){var r=u.get(t),n=u.get(e);return r>n?1:n>r?-1:0}).shift();if(t===e){for(var h=e,f=[h];o.has(h);)h=o.get(h),f.unshift(h);return{v:f}}n=n.concat(t),t.neighbours.filter(function(t){return!~n.indexOf(t.to)}).forEach(function(n){var h=s.get(t)+n.weight;if(~i.indexOf(n.to)){if(h>=s.get(n.to))return}else i=i.concat(n.to);o.set(n.to,t),s.set(n.to,h),u.set(n.to,h+r(n.to,e))})};i.length>0;){var f=h();if("object"==typeof f)return f.v}return[]}e="default"in e?e["default"]:e;var i={};i.classCallCheck=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")};var o={},s={};o.resources=function(e,r){return Object.keys(r).length?(Object.keys(r).reduce(function(t,e){return t.add(e,r[e])},e),t.Observable.fromCallback(e.load,e,function(t,e){return e})()):t.Observable.just({})},s.domReady=t.Observable.merge(t.Observable.just(),t.Observable.fromEvent(document,"readystatechange")).map(function(t){return document.readyState}).filter(function(t){return"complete"===t}).take(1),s.resize=t.Observable.merge(t.Observable.just(),t.Observable.fromEvent(window,"resize")).map(function(t){return[window.innerWidth,window.innerHeight]}).publishValue([window.innerWidth,window.innerHeight]),s.domRoot=s.domReady.flatMap(function(e){return t.Observable.just(document.body).map(function(t){return t.style.backgroundColor="#000",t.style.display="flex",t.style.justifyContent="center",t.style.height="100%",t.style.margin="0",t.style.flexDirection="column",t.parentNode.style.height="100%",t})}).take(1).publish();var u=function(t){return function(e){var r=Math.max(0,e-t);return t=e,r}};s.tick=t.Observable.create(function(t){var e=void 0,r=function(n){e&&(e=window.requestAnimationFrame(r)),t.onNext(n)};return e=window.requestAnimationFrame(r),function(){if(e){var t=e;e=void 0,window.cancelAnimationFrame(t)}}}).map(u(performance.now())).publish();var h=function(){function t(r){i.classCallCheck(this,t),this.config=r,this.renderer=function(t){var n=new e.WebGLRenderer(r.size.x,r.size.y,{antialias:!0});return n.plugins.interaction.destroy(),delete n.plugins.interaction,n}()}return t.prototype.mount=function(t){t.appendChild(this.renderer.view)},t.prototype.resize=function(t,e){this.renderer.view.style.height=this.config.size.y*(t/this.config.size.x)+"px"},t.prototype.start=function(){s.domRoot.connect(),s.resize.connect(),s.tick.connect()},t}(),f=r(function(t){function e(t,e,r,n,i,o){var s=["function ",t,"(a,l,h,",n.join(","),"){",o?"":"var i=",r?"l-1":"h+1",";while(l<=h){var m=(l+h)>>>1,x=a",i?".get(m)":"[m]"];return o?e.indexOf("c")<0?s.push(";if(x===y){return m}else if(x<=y){"):s.push(";var p=c(x,y);if(p===0){return m}else if(p<=0){"):s.push(";if(",e,"){i=m;"),r?s.push("l=m+1}else{h=m-1}"):s.push("h=m-1}else{l=m+1}"),s.push("}"),o?s.push("return -1};"):s.push("return i};"),s.join("")}function r(t,r,n,i){var o=new Function([e("A","x"+t+"y",r,["y"],!1,i),e("B","x"+t+"y",r,["y"],!0,i),e("P","c(x,y)"+t+"0",r,["y","c"],!1,i),e("Q","c(x,y)"+t+"0",r,["y","c"],!0,i),"function dispatchBsearch",n,"(a,y,c,l,h){if(a.shape){if(typeof(c)==='function'){return Q(a,(l===undefined)?0:l|0,(h===undefined)?a.shape[0]-1:h|0,y,c)}else{return B(a,(c===undefined)?0:c|0,(l===undefined)?a.shape[0]-1:l|0,y)}}else{if(typeof(c)==='function'){return P(a,(l===undefined)?0:l|0,(h===undefined)?a.length-1:h|0,y,c)}else{return A(a,(c===undefined)?0:c|0,(l===undefined)?a.length-1:l|0,y)}}}return dispatchBsearch",n].join(""));return o()}t.exports={ge:r(">=",!1,"GE"),gt:r(">",!1,"GT"),lt:r("<",!0,"LT"),le:r("<=",!0,"LE"),eq:r("-",!0,"EQ",!0)}}),l=f&&"object"==typeof f&&"default"in f?f["default"]:f,a=r(function(t){function e(t,e,r,n,i){this.mid=t,this.left=e,this.right=r,this.leftPoints=n,this.rightPoints=i,this.count=(e?e.count:0)+(r?r.count:0)+n.length}function r(t,e){t.mid=e.mid,t.left=e.left,t.right=e.right,t.leftPoints=e.leftPoints,t.rightPoints=e.rightPoints,t.count=e.count}function n(t,e){var r=g(e);t.mid=r.mid,t.left=r.left,t.right=r.right,t.leftPoints=r.leftPoints,t.rightPoints=r.rightPoints,t.count=r.count}function i(t,e){var r=t.intervals([]);r.push(e),n(t,r)}function o(t,e){var r=t.intervals([]),i=r.indexOf(e);return 0>i?y:(r.splice(i,1),n(t,r),m)}function s(t,e,r){for(var n=0;n<t.length&&t[n][0]<=e;++n){var i=r(t[n]);if(i)return i}}function u(t,e,r){for(var n=t.length-1;n>=0&&t[n][1]>=e;--n){var i=r(t[n]);if(i)return i}}function h(t,e){for(var r=0;r<t.length;++r){var n=e(t[r]);if(n)return n}}function f(t,e){return t-e}function a(t,e){var r=t[0]-e[0];return r?r:t[1]-e[1]}function c(t,e){var r=t[1]-e[1];return r?r:t[0]-e[0]}function g(t){if(0===t.length)return null;for(var r=[],n=0;n<t.length;++n)r.push(t[n][0],t[n][1]);r.sort(f);for(var i=r[r.length>>1],o=[],s=[],u=[],n=0;n<t.length;++n){var h=t[n];h[1]<i?o.push(h):i<h[0]?s.push(h):u.push(h)}var l=u,p=u.slice();return l.sort(a),p.sort(c),new e(i,g(o),g(s),l,p)}function p(t){this.root=t}function v(t){return new p(t&&0!==t.length?g(t):null)}var d=l,y=0,m=1,_=2;t.exports=v;var b=e.prototype;b.intervals=function(t){return t.push.apply(t,this.leftPoints),this.left&&this.left.intervals(t),this.right&&this.right.intervals(t),t},b.insert=function(t){var e=this.count-this.leftPoints.length;if(this.count+=1,t[1]<this.mid)this.left?4*(this.left.count+1)>3*(e+1)?i(this,t):this.left.insert(t):this.left=g([t]);else if(t[0]>this.mid)this.right?4*(this.right.count+1)>3*(e+1)?i(this,t):this.right.insert(t):this.right=g([t]);else{var r=d.ge(this.leftPoints,t,a),n=d.ge(this.rightPoints,t,c);this.leftPoints.splice(r,0,t),this.rightPoints.splice(n,0,t)}},b.remove=function(t){var e=this.count-this.leftPoints;if(t[1]<this.mid){if(!this.left)return y;var n=this.right?this.right.count:0;if(4*n>3*(e-1))return o(this,t);var i=this.left.remove(t);return i===_?(this.left=null,this.count-=1,m):(i===m&&(this.count-=1),i)}if(t[0]>this.mid){if(!this.right)return y;var s=this.left?this.left.count:0;if(4*s>3*(e-1))return o(this,t);var i=this.right.remove(t);return i===_?(this.right=null,this.count-=1,m):(i===m&&(this.count-=1),i)}if(1===this.count)return this.leftPoints[0]===t?_:y;if(1===this.leftPoints.length&&this.leftPoints[0]===t){if(this.left&&this.right){for(var u=this,h=this.left;h.right;)u=h,h=h.right;if(u===this)h.right=this.right;else{var f=this.left,i=this.right;u.count-=h.count,u.right=h.left,h.left=f,h.right=i}r(this,h),this.count=(this.left?this.left.count:0)+(this.right?this.right.count:0)+this.leftPoints.length}else this.left?r(this,this.left):r(this,this.right);return m}for(var f=d.ge(this.leftPoints,t,a);f<this.leftPoints.length&&this.leftPoints[f][0]===t[0];++f)if(this.leftPoints[f]===t){this.count-=1,this.leftPoints.splice(f,1);for(var i=d.ge(this.rightPoints,t,c);i<this.rightPoints.length&&this.rightPoints[i][1]===t[1];++i)if(this.rightPoints[i]===t)return this.rightPoints.splice(i,1),m}return y},b.queryPoint=function(t,e){if(t<this.mid){if(this.left){var r=this.left.queryPoint(t,e);if(r)return r}return s(this.leftPoints,t,e)}if(t>this.mid){if(this.right){var r=this.right.queryPoint(t,e);if(r)return r}return u(this.rightPoints,t,e)}return h(this.leftPoints,e)},b.queryInterval=function(t,e,r){if(t<this.mid&&this.left){var n=this.left.queryInterval(t,e,r);if(n)return n}if(e>this.mid&&this.right){var n=this.right.queryInterval(t,e,r);if(n)return n}return e<this.mid?s(this.leftPoints,e,r):t>this.mid?u(this.rightPoints,t,r):h(this.leftPoints,r)};var w=p.prototype;w.insert=function(t){this.root?this.root.insert(t):this.root=new e(t[0],null,null,[t],[t])},w.remove=function(t){if(this.root){var e=this.root.remove(t);return e===_&&(this.root=null),e!==y}return!1},w.queryPoint=function(t,e){return this.root?this.root.queryPoint(t,e):void 0},w.queryInterval=function(t,e,r){return e>=t&&this.root?this.root.queryInterval(t,e,r):void 0},Object.defineProperty(w,"count",{get:function(){return this.root?this.root.count:0}}),Object.defineProperty(w,"intervals",{get:function(){return this.root?this.root.intervals([]):[]}})}),c=a&&"object"==typeof a&&"default"in a?a["default"]:a,g=r(function(t){function e(t,e){var r=t+e,n=r-t,i=r-n,o=e-n,s=t-i,u=s+o;return u?[u,r]:[r]}function r(t,r){var n=0|t.length,i=0|r.length;if(1===n&&1===i)return e(t[0],-r[0]);var o,s,u=n+i,h=new Array(u),f=0,l=0,a=0,c=Math.abs,g=t[l],p=c(g),v=-r[a],d=c(v);d>p?(s=g,l+=1,n>l&&(g=t[l],p=c(g))):(s=v,a+=1,i>a&&(v=-r[a],d=c(v))),n>l&&d>p||a>=i?(o=g,l+=1,n>l&&(g=t[l],p=c(g))):(o=v,a+=1,i>a&&(v=-r[a],d=c(v)));for(var y,m,_,b,w,x=o+s,k=x-o,P=s-k,j=P,O=x;n>l&&i>a;)d>p?(o=g,l+=1,n>l&&(g=t[l],p=c(g))):(o=v,a+=1,i>a&&(v=-r[a],d=c(v))),s=j,x=o+s,k=x-o,P=s-k,P&&(h[f++]=P),y=O+x,m=y-O,_=y-m,b=x-m,w=O-_,j=w+b,O=y;for(;n>l;)o=g,s=j,x=o+s,k=x-o,P=s-k,P&&(h[f++]=P),y=O+x,m=y-O,_=y-m,b=x-m,w=O-_,j=w+b,O=y,l+=1,n>l&&(g=t[l]);for(;i>a;)o=v,s=j,x=o+s,k=x-o,P=s-k,P&&(h[f++]=P),y=O+x,m=y-O,_=y-m,b=x-m,w=O-_,j=w+b,O=y,a+=1,i>a&&(v=-r[a]);return j&&(h[f++]=j),O&&(h[f++]=O),f||(h[f++]=0),h.length=f,h}t.exports=r}),p=g&&"object"==typeof g&&"default"in g?g["default"]:g,v=r(function(t){function e(t,e,r){var n=t+e,i=n-t,o=n-i,s=e-i,u=t-o;return r?(r[0]=u+s,r[1]=n,r):[u+s,n]}t.exports=e}),d=v&&"object"==typeof v&&"default"in v?v["default"]:v,y=r(function(t){function e(t,e,n){var i=t*e,o=r*t,s=o-t,u=o-s,h=t-u,f=r*e,l=f-e,a=f-l,c=e-a,g=i-u*a,p=g-h*a,v=p-u*c,d=h*c-v;return n?(n[0]=d,n[1]=i,n):[d,i]}t.exports=e;var r=+(Math.pow(2,27)+1)}),m=y&&"object"==typeof y&&"default"in y?y["default"]:y,_=r(function(t){function e(t,e){var i=t.length;if(1===i){var o=r(t[0],e);return o[0]?o:[o[1]]}var s=new Array(2*i),u=[.1,.1],h=[.1,.1],f=0;r(t[0],e,u),u[0]&&(s[f++]=u[0]);for(var l=1;i>l;++l){r(t[l],e,h);var a=u[1];n(a,h[0],u),u[0]&&(s[f++]=u[0]);var c=h[1],g=u[1],p=c+g,v=p-c,d=g-v;u[1]=p,d&&(s[f++]=d)}return u[1]&&(s[f++]=u[1]),0===f&&(s[f++]=0),s.length=f,s}var r=m,n=d;t.exports=e}),b=_&&"object"==typeof _&&"default"in _?_["default"]:_,w=r(function(t){function e(t,e){var r=t+e,n=r-t,i=r-n,o=e-n,s=t-i,u=s+o;return u?[u,r]:[r]}function r(t,r){var n=0|t.length,i=0|r.length;if(1===n&&1===i)return e(t[0],r[0]);var o,s,u=n+i,h=new Array(u),f=0,l=0,a=0,c=Math.abs,g=t[l],p=c(g),v=r[a],d=c(v);d>p?(s=g,l+=1,n>l&&(g=t[l],p=c(g))):(s=v,a+=1,i>a&&(v=r[a],d=c(v))),n>l&&d>p||a>=i?(o=g,l+=1,n>l&&(g=t[l],p=c(g))):(o=v,a+=1,i>a&&(v=r[a],d=c(v)));for(var y,m,_,b,w,x=o+s,k=x-o,P=s-k,j=P,O=x;n>l&&i>a;)d>p?(o=g,l+=1,n>l&&(g=t[l],p=c(g))):(o=v,a+=1,i>a&&(v=r[a],d=c(v))),s=j,x=o+s,k=x-o,P=s-k,P&&(h[f++]=P),y=O+x,m=y-O,_=y-m,b=x-m,w=O-_,j=w+b,O=y;for(;n>l;)o=g,s=j,x=o+s,k=x-o,P=s-k,P&&(h[f++]=P),y=O+x,m=y-O,_=y-m,b=x-m,w=O-_,j=w+b,O=y,l+=1,n>l&&(g=t[l]);for(;i>a;)o=v,s=j,x=o+s,k=x-o,P=s-k,P&&(h[f++]=P),y=O+x,m=y-O,_=y-m,b=x-m,w=O-_,j=w+b,O=y,a+=1,i>a&&(v=r[a]);return j&&(h[f++]=j),O&&(h[f++]=O),f||(h[f++]=0),h.length=f,h}t.exports=r}),x=w&&"object"==typeof w&&"default"in w?w["default"]:w,k=r(function(t){function e(t,e){for(var r=new Array(t.length-1),n=1;n<t.length;++n)for(var i=r[n-1]=new Array(t.length-1),o=0,s=0;o<t.length;++o)o!==e&&(i[s++]=t[n][o]);return r}function r(t){for(var e=new Array(t),r=0;t>r;++r){e[r]=new Array(t);for(var n=0;t>n;++n)e[r][n]=["m",n,"[",t-r-1,"]"].join("")}return e}function n(t){return 1&t?"-":""}function i(t){if(1===t.length)return t[0];if(2===t.length)return["sum(",t[0],",",t[1],")"].join("");var e=t.length>>1;return["sum(",i(t.slice(0,e)),",",i(t.slice(e)),")"].join("")}function o(t){if(2===t.length)return[["sum(prod(",t[0][0],",",t[1][1],"),prod(-",t[0][1],",",t[1][0],"))"].join("")];for(var r=[],s=0;s<t.length;++s)r.push(["scale(",i(o(e(t,s))),",",n(s),t[0][s],")"].join(""));return r}function s(t){for(var n=[],s=[],u=r(t),h=[],g=0;t>g;++g)0===(1&g)?n.push.apply(n,o(e(u,g))):s.push.apply(s,o(e(u,g))),h.push("m"+g);var p=i(n),v=i(s),d="orientation"+t+"Exact",y=["function ",d,"(",h.join(),"){var p=",p,",n=",v,",d=sub(p,n);return d[d.length-1];};return ",d].join(""),m=new Function("sum","prod","scale","sub",y);return m(l,f,a,c)}function u(t){var e=k[t.length];return e||(e=k[t.length]=s(t.length)),e.apply(void 0,t)}function h(){for(;k.length<=g;)k.push(s(k.length));for(var e=[],r=["slow"],n=0;g>=n;++n)e.push("a"+n),r.push("o"+n);for(var i=["function getOrientation(",e.join(),"){switch(arguments.length){case 0:case 1:return 0;"],n=2;g>=n;++n)i.push("case ",n,":return o",n,"(",e.slice(0,n).join(),");");i.push("}var s=new Array(arguments.length);for(var i=0;i<arguments.length;++i){s[i]=arguments[i]};return slow(s);}return getOrientation"),r.push(i.join(""));var o=Function.apply(void 0,r);t.exports=o.apply(void 0,[u].concat(k));for(var n=0;g>=n;++n)t.exports[n]=k[n]}var f=m,l=x,a=b,c=p,g=5,v=1.1102230246251565e-16,d=(3+16*v)*v,y=(7+56*v)*v,_=s(3),w=s(4),k=[function(){return 0},function(){return 0},function(t,e){return e[0]-t[0]},function(t,e,r){var n,i=(t[1]-r[1])*(e[0]-r[0]),o=(t[0]-r[0])*(e[1]-r[1]),s=i-o;if(i>0){if(0>=o)return s;n=i+o}else{if(!(0>i))return s;if(o>=0)return s;n=-(i+o)}var u=d*n;return s>=u||-u>=s?s:_(t,e,r)},function(t,e,r,n){var i=t[0]-n[0],o=e[0]-n[0],s=r[0]-n[0],u=t[1]-n[1],h=e[1]-n[1],f=r[1]-n[1],l=t[2]-n[2],a=e[2]-n[2],c=r[2]-n[2],g=o*f,p=s*h,v=s*u,d=i*f,m=i*h,_=o*u,b=l*(g-p)+a*(v-d)+c*(m-_),x=(Math.abs(g)+Math.abs(p))*Math.abs(l)+(Math.abs(v)+Math.abs(d))*Math.abs(a)+(Math.abs(m)+Math.abs(_))*Math.abs(c),k=y*x;return b>k||-b>k?b:w(t,e,r,n)}];h()}),P=k&&"object"==typeof k&&"default"in k?k["default"]:k,j=r(function(t){function e(t,e){var r,i;if(e[0][0]<e[1][0])r=e[0],i=e[1];else{if(!(e[0][0]>e[1][0])){var o=Math.min(t[0][1],t[1][1]),s=Math.max(t[0][1],t[1][1]),u=Math.min(e[0][1],e[1][1]),h=Math.max(e[0][1],e[1][1]);return u>s?s-u:o>h?o-h:s-h}r=e[1],i=e[0]}var f,l;t[0][1]<t[1][1]?(f=t[0],l=t[1]):(f=t[1],l=t[0]);var a=n(i,r,f);return a?a:(a=n(i,r,l),a?a:l-i)}function r(t,r){var i,o;if(r[0][0]<r[1][0])i=r[0],o=r[1];else{if(!(r[0][0]>r[1][0]))return e(r,t);i=r[1],o=r[0]}var s,u;if(t[0][0]<t[1][0])s=t[0],u=t[1];else{if(!(t[0][0]>t[1][0]))return-e(t,r);s=t[1],u=t[0]}var h=n(i,o,u),f=n(i,o,s);if(0>h){if(0>=f)return h}else if(h>0){if(f>=0)return h}else if(f)return f;if(h=n(u,s,o),f=n(u,s,i),0>h){if(0>=f)return h}else if(h>0){if(f>=0)return h}else if(f)return f;return o[0]-u[0]}t.exports=r;var n=P}),O=j&&"object"==typeof j&&"default"in j?j["default"]:j,C=r(function(t){function e(t,e,r,n,i,o){this._color=t,this.key=e,this.value=r,this.left=n,this.right=i,this._count=o}function r(t){return new e(t._color,t.key,t.value,t.left,t.right,t._count)}function n(t,r){return new e(t,r.key,r.value,r.left,r.right,r._count)}function i(t){t._count=1+(t.left?t.left._count:0)+(t.right?t.right._count:0)}function o(t,e){this._compare=t,this.root=e}function s(t,e){if(e.left){var r=s(t,e.left);if(r)return r}var r=t(e.key,e.value);return r?r:e.right?s(t,e.right):void 0}function u(t,e,r,n){var i=e(t,n.key);if(0>=i){if(n.left){var o=u(t,e,r,n.left);if(o)return o}var o=r(n.key,n.value);if(o)return o}return n.right?u(t,e,r,n.right):void 0}function h(t,e,r,n,i){var o,s=r(t,i.key),u=r(e,i.key);if(0>=s){if(i.left&&(o=h(t,e,r,n,i.left)))return o;if(u>0&&(o=n(i.key,i.value)))return o}return u>0&&i.right?h(t,e,r,n,i.right):void 0}function f(t,e){this.tree=t,this._stack=e}function l(t,e){t.key=e.key,t.value=e.value,t.left=e.left,t.right=e.right,t._color=e._color,t._count=e._count}function a(t){for(var e,o,s,u,h=t.length-1;h>=0;--h){if(e=t[h],0===h)return void(e._color=v);if(o=t[h-1],o.left===e){if(s=o.right,s.right&&s.right._color===p){if(s=o.right=r(s),u=s.right=r(s.right),o.right=s.left,s.left=o,s.right=u,s._color=o._color,e._color=v,o._color=v,u._color=v,i(o),i(s),h>1){var f=t[h-2];f.left===o?f.left=s:f.right=s}return void(t[h-1]=s)}if(s.left&&s.left._color===p){if(s=o.right=r(s),u=s.left=r(s.left),o.right=u.left,s.left=u.right,u.left=o,u.right=s,u._color=o._color,o._color=v,s._color=v,e._color=v,i(o),i(s),i(u),h>1){var f=t[h-2];f.left===o?f.left=u:f.right=u}return void(t[h-1]=u)}if(s._color===v){if(o._color===p)return o._color=v,void(o.right=n(p,s));o.right=n(p,s);continue}if(s=r(s),o.right=s.left,s.left=o,s._color=o._color,o._color=p,i(o),i(s),h>1){var f=t[h-2];f.left===o?f.left=s:f.right=s}t[h-1]=s,t[h]=o,h+1<t.length?t[h+1]=e:t.push(e),h+=2}else{if(s=o.left,s.left&&s.left._color===p){if(s=o.left=r(s),u=s.left=r(s.left),o.left=s.right,s.right=o,s.left=u,s._color=o._color,e._color=v,o._color=v,u._color=v,i(o),i(s),h>1){var f=t[h-2];f.right===o?f.right=s:f.left=s}return void(t[h-1]=s)}if(s.right&&s.right._color===p){if(s=o.left=r(s),u=s.right=r(s.right),o.left=u.right,s.right=u.left,u.right=o,u.left=s,u._color=o._color,o._color=v,s._color=v,e._color=v,i(o),i(s),i(u),h>1){var f=t[h-2];f.right===o?f.right=u:f.left=u}return void(t[h-1]=u)}if(s._color===v){if(o._color===p)return o._color=v,void(o.left=n(p,s));o.left=n(p,s);continue}if(s=r(s),o.left=s.right,s.right=o,s._color=o._color,o._color=p,i(o),i(s),h>1){var f=t[h-2];f.right===o?f.right=s:f.left=s}t[h-1]=s,t[h]=o,h+1<t.length?t[h+1]=e:t.push(e),h+=2}}}function c(t,e){return e>t?-1:t>e?1:0}function g(t){return new o(t||c,null)}t.exports=g;var p=0,v=1,d=o.prototype;Object.defineProperty(d,"keys",{get:function(){var t=[];return this.forEach(function(e,r){t.push(e)}),t}}),Object.defineProperty(d,"values",{get:function(){var t=[];return this.forEach(function(e,r){t.push(r)}),t}}),Object.defineProperty(d,"length",{get:function(){return this.root?this.root._count:0}}),d.insert=function(t,r){for(var s=this._compare,u=this.root,h=[],f=[];u;){var l=s(t,u.key);h.push(u),f.push(l),u=0>=l?u.left:u.right}h.push(new e(p,t,r,null,null,1));for(var a=h.length-2;a>=0;--a){var u=h[a];f[a]<=0?h[a]=new e(u._color,u.key,u.value,h[a+1],u.right,u._count+1):h[a]=new e(u._color,u.key,u.value,u.left,h[a+1],u._count+1)}for(var a=h.length-1;a>1;--a){var c=h[a-1],u=h[a];if(c._color===v||u._color===v)break;var g=h[a-2];if(g.left===c)if(c.left===u){var d=g.right;if(!d||d._color!==p){if(g._color=p,g.left=c.right,c._color=v,c.right=g,h[a-2]=c,h[a-1]=u,i(g),i(c),a>=3){var y=h[a-3];y.left===g?y.left=c:y.right=c}break}c._color=v,g.right=n(v,d),g._color=p,a-=1}else{var d=g.right;if(!d||d._color!==p){if(c.right=u.left,g._color=p,g.left=u.right,u._color=v,u.left=c,u.right=g,h[a-2]=u,h[a-1]=c,i(g),i(c),i(u),a>=3){var y=h[a-3];y.left===g?y.left=u:y.right=u}break}c._color=v,g.right=n(v,d),g._color=p,a-=1}else if(c.right===u){var d=g.left;if(!d||d._color!==p){if(g._color=p,g.right=c.left,c._color=v,c.left=g,h[a-2]=c,h[a-1]=u,i(g),i(c),a>=3){var y=h[a-3];y.right===g?y.right=c:y.left=c}break}c._color=v,g.left=n(v,d),g._color=p,a-=1}else{var d=g.left;if(!d||d._color!==p){if(c.left=u.right,g._color=p,g.right=u.left,u._color=v,u.right=c,u.left=g,h[a-2]=u,h[a-1]=c,i(g),i(c),i(u),a>=3){var y=h[a-3];y.right===g?y.right=u:y.left=u}break}c._color=v,g.left=n(v,d),g._color=p,a-=1}}return h[0]._color=v,new o(s,h[0])},d.forEach=function(t,e,r){if(this.root)switch(arguments.length){case 1:return s(t,this.root);case 2:return u(e,this._compare,t,this.root);case 3:if(this._compare(e,r)>=0)return;return h(e,r,this._compare,t,this.root)}},Object.defineProperty(d,"begin",{get:function(){for(var t=[],e=this.root;e;)t.push(e),e=e.left;return new f(this,t)}}),Object.defineProperty(d,"end",{get:function(){for(var t=[],e=this.root;e;)t.push(e),e=e.right;return new f(this,t)}}),d.at=function(t){if(0>t)return new f(this,[]);for(var e=this.root,r=[];;){if(r.push(e),e.left){if(t<e.left._count){e=e.left;continue}t-=e.left._count}if(!t)return new f(this,r);if(t-=1,!e.right)break;if(t>=e.right._count)break;e=e.right}return new f(this,[])},d.ge=function(t){for(var e=this._compare,r=this.root,n=[],i=0;r;){var o=e(t,r.key);n.push(r),0>=o&&(i=n.length),r=0>=o?r.left:r.right}return n.length=i,new f(this,n)},d.gt=function(t){for(var e=this._compare,r=this.root,n=[],i=0;r;){var o=e(t,r.key);n.push(r),0>o&&(i=n.length),r=0>o?r.left:r.right}return n.length=i,new f(this,n)},d.lt=function(t){for(var e=this._compare,r=this.root,n=[],i=0;r;){var o=e(t,r.key);n.push(r),o>0&&(i=n.length),r=0>=o?r.left:r.right}return n.length=i,new f(this,n)},d.le=function(t){for(var e=this._compare,r=this.root,n=[],i=0;r;){var o=e(t,r.key);n.push(r),o>=0&&(i=n.length),r=0>o?r.left:r.right}return n.length=i,new f(this,n)},d.find=function(t){for(var e=this._compare,r=this.root,n=[];r;){var i=e(t,r.key);if(n.push(r),0===i)return new f(this,n);r=0>=i?r.left:r.right}return new f(this,[])},d.remove=function(t){var e=this.find(t);return e?e.remove():this},d.get=function(t){for(var e=this._compare,r=this.root;r;){var n=e(t,r.key);if(0===n)return r.value;r=0>=n?r.left:r.right}};var y=f.prototype;Object.defineProperty(y,"valid",{get:function(){return this._stack.length>0}}),Object.defineProperty(y,"node",{get:function(){return this._stack.length>0?this._stack[this._stack.length-1]:null},enumerable:!0}),y.clone=function(){return new f(this.tree,this._stack.slice())},y.remove=function(){var t=this._stack;if(0===t.length)return this.tree;var r=new Array(t.length),n=t[t.length-1];r[r.length-1]=new e(n._color,n.key,n.value,n.left,n.right,n._count);for(var i=t.length-2;i>=0;--i){var n=t[i];n.left===t[i+1]?r[i]=new e(n._color,n.key,n.value,r[i+1],n.right,n._count):r[i]=new e(n._color,n.key,n.value,n.left,r[i+1],n._count)}if(n=r[r.length-1],n.left&&n.right){var s=r.length;for(n=n.left;n.right;)r.push(n),n=n.right;var u=r[s-1];r.push(new e(n._color,u.key,u.value,n.left,n.right,n._count)),r[s-1].key=n.key,r[s-1].value=n.value;for(var i=r.length-2;i>=s;--i)n=r[i],r[i]=new e(n._color,n.key,n.value,n.left,r[i+1],n._count);r[s-1].left=r[s]}if(n=r[r.length-1],n._color===p){var h=r[r.length-2];h.left===n?h.left=null:h.right===n&&(h.right=null),r.pop();for(var i=0;i<r.length;++i)r[i]._count--;return new o(this.tree._compare,r[0])}if(n.left||n.right){n.left?l(n,n.left):n.right&&l(n,n.right),n._color=v;for(var i=0;i<r.length-1;++i)r[i]._count--;return new o(this.tree._compare,r[0])}if(1===r.length)return new o(this.tree._compare,null);for(var i=0;i<r.length;++i)r[i]._count--;var f=r[r.length-2];return a(r),f.left===n?f.left=null:f.right=null,new o(this.tree._compare,r[0])},Object.defineProperty(y,"key",{get:function(){return this._stack.length>0?this._stack[this._stack.length-1].key:void 0},enumerable:!0}),Object.defineProperty(y,"value",{get:function(){return this._stack.length>0?this._stack[this._stack.length-1].value:void 0},enumerable:!0}),Object.defineProperty(y,"index",{get:function(){var t=0,e=this._stack;if(0===e.length){var r=this.tree.root;return r?r._count:0}e[e.length-1].left&&(t=e[e.length-1].left._count);for(var n=e.length-2;n>=0;--n)e[n+1]===e[n].right&&(++t,e[n].left&&(t+=e[n].left._count));return t},enumerable:!0}),y.next=function(){var t=this._stack;if(0!==t.length){var e=t[t.length-1];if(e.right)for(e=e.right;e;)t.push(e),e=e.left;else for(t.pop();t.length>0&&t[t.length-1].right===e;)e=t[t.length-1],t.pop()}},Object.defineProperty(y,"hasNext",{get:function(){var t=this._stack;if(0===t.length)return!1;if(t[t.length-1].right)return!0;for(var e=t.length-1;e>0;--e)if(t[e-1].left===t[e])return!0;return!1}}),y.update=function(t){var r=this._stack;if(0===r.length)throw new Error("Can't update empty node!");var n=new Array(r.length),i=r[r.length-1];n[n.length-1]=new e(i._color,i.key,t,i.left,i.right,i._count);for(var s=r.length-2;s>=0;--s)i=r[s],i.left===r[s+1]?n[s]=new e(i._color,i.key,i.value,n[s+1],i.right,i._count):n[s]=new e(i._color,i.key,i.value,i.left,n[s+1],i._count);return new o(this.tree._compare,n[0])},y.prev=function(){var t=this._stack;if(0!==t.length){var e=t[t.length-1];if(e.left)for(e=e.left;e;)t.push(e),e=e.right;else for(t.pop();t.length>0&&t[t.length-1].left===e;)e=t[t.length-1],t.pop()}},Object.defineProperty(y,"hasPrev",{get:function(){var t=this._stack;if(0===t.length)return!1;if(t[t.length-1].left)return!0;for(var e=t.length-1;e>0;--e)if(t[e-1].right===t[e])return!0;return!1}})}),q=C&&"object"==typeof C&&"default"in C?C["default"]:C,M=r(function(t){function e(t,e,r){this.slabs=t,this.coordinates=e,this.horizontal=r}function r(t,e){return t.y-e}function n(t,e){for(var r=null;t;){var i,o,s=t.key;s[0][0]<s[1][0]?(i=s[0],o=s[1]):(i=s[1],o=s[0]);var u=f(i,o,e);if(0>u)t=t.left;else if(u>0)if(e[0]!==s[1][0])r=t,t=t.right;else{var h=n(t.right,e);if(h)return h;t=t.left}else{if(e[0]!==s[1][0])return t;var h=n(t.right,e);if(h)return h;t=t.left}}return r}function i(t,e,r,n){this.y=t,this.index=e,this.start=r,this.closed=n}function o(t,e,r,n){this.x=t,this.segment=e,this.create=r,this.index=n}function s(t){for(var r=t.length,n=2*r,s=new Array(n),u=0;r>u;++u){var f=t[u],l=f[0][0]<f[1][0];s[2*u]=new o(f[0][0],f,l,u),s[2*u+1]=new o(f[1][0],f,!l,u)}s.sort(function(t,e){var r=t.x-e.x;return r?r:(r=t.create-e.create,r?r:Math.min(t.segment[0][1],t.segment[1][1])-Math.min(e.segment[0][1],e.segment[1][1]))});for(var c=h(a),g=[],p=[],v=[],u=0;n>u;){for(var d=s[u].x,y=[];n>u;){var m=s[u];if(m.x!==d)break;u+=1,m.segment[0][0]===m.x&&m.segment[1][0]===m.x?m.create&&(m.segment[0][1]<m.segment[1][1]?(y.push(new i(m.segment[0][1],m.index,!0,!0)),y.push(new i(m.segment[1][1],m.index,!1,!1))):(y.push(new i(m.segment[1][1],m.index,!0,!1)),y.push(new i(m.segment[0][1],m.index,!1,!0)))):c=m.create?c.insert(m.segment,m.index):c.remove(m.segment)}g.push(c.root),p.push(d),v.push(y)}return new e(g,p,v)}t.exports=s;var u=l,h=q,f=P,a=O,c=e.prototype;c.castUp=function(t){var e=u.le(this.coordinates,t[0]);if(0>e)return-1;var i=(this.slabs[e],n(this.slabs[e],t)),o=-1;if(i&&(o=i.value),this.coordinates[e]===t[0]){var s=null;if(i&&(s=i.key),e>0){var h=n(this.slabs[e-1],t);h&&(s?a(h.key,s)>0&&(s=h.key,o=h.value):(o=h.value,s=h.key))}var l=this.horizontal[e];if(l.length>0){var c=u.ge(l,t[1],r);if(c<l.length){var g=l[c];if(t[1]===g.y){if(g.closed)return g.index;for(;c<l.length-1&&l[c+1].y===t[1];)if(c+=1,g=l[c],g.closed)return g.index;if(g.y===t[1]&&!g.start){if(c+=1,c>=l.length)return o;g=l[c]}}if(g.start)if(s){var p=f(s[0],s[1],[t[0],g.y]);s[0][0]>s[1][0]&&(p=-p),p>0&&(o=g.index)}else o=g.index;else g.y!==t[1]&&(o=g.index)}}}return o}}),E=M&&"object"==typeof M&&"default"in M?M["default"]:M,z=r(function(t){function e(){return!0}function r(t){return function(r,n){var i=t[r];return i?!!i.queryPoint(n,e):!1}}function n(t){for(var e={},n=0;n<t.length;++n){var i=t[n],o=i[0][0],s=i[0][1],u=i[1][1],h=[Math.min(s,u),Math.max(s,u)];o in e?e[o].push(h):e[o]=[h]}for(var f={},l=Object.keys(e),n=0;n<l.length;++n){var a=e[l[n]];f[l[n]]=g(a)}return r(f)}function i(t,e){return function(r){var n=p.le(e,r[0]);if(0>n)return 1;var i=t[n];if(!i){if(!(n>0&&e[n]===r[0]))return 1;i=t[n-1]}for(var o=1;i;){var s=i.key,u=f(r,s[0],s[1]);if(s[0][0]<s[1][0])if(0>u)i=i.left;else{if(!(u>0))return 0;o=-1,i=i.right}else if(u>0)i=i.left;else{if(!(0>u))return 0;o=1,i=i.right}}return o}}function o(t){return 1}function s(t){return function(e){return t(e[0],e[1])?0:1}}function u(t,e){return function(r){return t(r[0],r[1])?0:e(r)}}function h(t){for(var e=t.length,r=[],h=[],f=0;e>f;++f)for(var l=t[f],c=l.length,g=c-1,p=0;c>p;g=p++){var v=l[g],d=l[p];v[0]===d[0]?h.push([v,d]):r.push([v,d])}if(0===r.length)return 0===h.length?o:s(n(h));var y=a(r),m=i(y.slabs,y.coordinates);return 0===h.length?m:u(n(h),m)}t.exports=h;var f=P[3],a=E,g=c,p=l}),A=z&&"object"==typeof z&&"default"in z?z["default"]:z,I=function(){function t(e,r){i.classCallCheck(this,t),this.x=e,this.y=r}return t.prototype.arr=function(){return[this.x,this.y]},t.prototype.distSq=function(t){var e=t.x-this.x,r=t.y-this.y;return e*e+r*r},t.prototype.dist=function(t){return Math.sqrt(this.distSq(t))},t.prototype.len=function(){return this.dist(t.ORIGO)},t.prototype.norm=function(){var e=this.len();return new t(this.x/e,this.y/e)},t.prototype.dot=function(t){return this.x*t.x+this.y*t.y},t.prototype.scale=function(e){return new t(this.x*e,this.y*e)},t.prototype.add=function(e){return new t(this.x+e.x,this.y+e.y)},t.prototype.sub=function(t){return this.add(t.scale(-1))},t.prototype.equals=function(t){return this===t||this.x===t.x&&this.y===t.y},t.fromArray=function(e){return new t(e[0],e[1])},t}();I.ORIGO=new I(0,0),I.INF=new I(1/0,1/0);var N=function(){function t(e,r){i.classCallCheck(this,t),this.a=e,this.b=r}return t.prototype.equals=function(t){return this===t||this.a.equals(t.a)&&this.b.equals(t.b)},t.prototype.centerPoint=function(){return this.a.add(this.b).scale(.5)},t.prototype.dir=function(){return this.b.sub(this.a).norm()},t.prototype.len=function(){return this.a.dist(this.b)},t.prototype.intersects=function(t){var e=this.b.x-this.a.x,r=this.b.y-this.a.y,n=t.b.x-t.a.x,i=t.b.y-t.a.y,o=(-r*(this.a.x-t.a.x)+e*(this.a.y-t.a.y))/(-n*r+e*i),s=(n*(this.a.y-t.a.y)-i*(this.a.x-t.a.x))/(-n*r+e*i),u=1e-5;return o-u>0&&1>o+u&&s-u>0&&1>s+u},t.prototype.closestTo=function(t){var e=this.dir(),r=t.dot(e)/e.dot(e);this.len();return r>=this.len()?this.b:0>=r?this.a:e.scale(t.dot(e)/e.dot(e)).add(this.a)},t.fromArray=function(e,r){return new t(I.fromArray(e),I.fromArray(r))},t}(),S=function(){function t(e){i.classCallCheck(this,t),this.points=e}return t.prototype.serialize=function(){return this.points.map(function(t){return t.arr()})},t.prototype.isClockwise=function(){return this.area()>0},t.prototype.area=function e(){for(var e=0,t=this.points[0],r=2;r<this.points.length;r++){var n=this.points[r-1],i=this.points[r],o=t.sub(n),s=t.sub(i);e+=o.x*s.y-o.y*s.x}return e/2},t.prototype.sides=function(){return this.points.map(function(t,e,r){return new N(t,r[(e+1)%r.length])})},t.prototype.intersectsLine=function(t){return this.sides().some(function(e){return e.intersects(t)})},t.prototype.intersectsPoly=function(t){var e=this;return t.sides().some(function(t){return e.intersectsLine(t)})},t.prototype.contains=function(t){for(var e=arguments.length<=1||void 0===arguments[1]?.1:arguments[1],r=this.points[this.points.length-1],n=r.distSq(t),i=!1,o=null,s=null,u=0;u<this.points.length;u++){var h=this.points[u],f=h.distSq(t);if(n+f+2*Math.sqrt(n*f)-h.distSq(r)<e)return!0;h.x>r.x?(o=r,s=h):(o=h,s=r),h.x<t.x==t.x<=r.x&&(t.y-o.y)*(s.x-o.x)<(s.y-o.y)*(t.x-o.x)&&(i=!i),r=h,n=f}return i||this.points.some(function(e){return e.equals(t)})},t.prototype.nearestEdgePoint=function(t){var e=I.INF;return this.points.forEach(function(r,n,i){var o=i[(n+1)%i.length],s=new N(r,o).closestTo(t.sub(r));s.dist(t)<e.dist(t)&&(e=s)}),e},t.fromSerialized=function(e){return new t(e.map(I.fromArray))},t}(),L=function(){function t(e){i.classCallCheck(this,t),e.isClockwise()&&(console.warn("got clockwise bounds, rewinding to anti-clockwise"),e.points.reverse()),this.bounds=e,this.interior=[],this.updateClassifier()}return t.prototype.updateClassifier=function(){var t=this.serialize(),e=t.bounds,r=t.holes;this.classifyPoint=A([e].concat(r||[]))},t.prototype.serialize=function(){return{bounds:this.bounds.serialize(),holes:this.interior.map(function(t){return t.serialize()})}},t.prototype.addHole=function(t){if(t.points.length<2)throw Error("Not a polygon");if(!this.containsPolygon(t))throw Error("Trying to add interior polygon that is not contained in this");t.isClockwise()||(console.warn("got anti-clockwise hole, rewinding to clockwise"),t.points.reverse()),this.interior=this.interior.concat(t),this.updateClassifier()},t.prototype.containsPolygon=function(t){return this.contains(t.points[0])&&!this.intersectsPoly(t)},t.prototype.intersectsLine=function(t){return this.bounds.intersectsLine(t)||this.interior.some(function(e){return e.intersectsLine(t)})},t.prototype.intersectsPoly=function(t){return this.bounds.intersectsPoly(t)||this.interior.some(function(e){return e.intersectsPoly(t)})},t.prototype.containsPIBP=function(t){
return this.classifyPoint(t.arr())},t.prototype.contains=function(t){return this.containsPIBP(t)<=0},t.prototype.nearestEdgePoint=function(t){var e=this.bounds.nearestEdgePoint(t),r=this.interior.find(function(e){return e.contains(t)});if(r){var n=r.nearestEdgePoint(t);n.dist(t)<e.dist(t)&&(e=n)}return this.containsPIBP(e)>0?(console.warn("edge point is not inside quick to fix.."),this.nearestEdgePoint(t.add(new I(.01,.01)))):e},t.prototype.nearestInside=function(t){return this.contains(t)?t:this.nearestEdgePoint(t)},t.fromSerialized=function(e){var r=e.bounds,n=e.holes,i=new t(S.fromSerialized(r));return n.map(S.fromSerialized).forEach(i.addHole.bind(i)),i},t}(),R=Object.freeze({Vec2:I,Line2:N,SimplePolygon:S,Polygon:L}),F=function(){function t(e){i.classCallCheck(this,t),this.pos=e,this.neighbours=[]}return t.prototype.link=function(t){this.neighbours=this.neighbours.concat(new T(this,t))},t.prototype.unlink=function(){var t=this;this.neighbours.forEach(function(e){var r=e.to;r.neighbours=r.neighbours.filter(function(e){var r=e.to;return r!==t})})},t}(),T=function Q(t,e){i.classCallCheck(this,Q),this.to=e,this.weight=t.pos.dist(e.pos)},B=function(){function t(e,r){i.classCallCheck(this,t),this.nodes=e,this.polygon=r}return t.prototype.linkNodes=function(t,e){t.link(e),e.link(t),~this.nodes.indexOf(t)||this.nodes.push(t),~this.nodes.indexOf(e)||this.nodes.push(e)},t.prototype.connectNode=function(t){this._connect(this.nodes,t)},t.prototype.unlinkNode=function(t){t.unlink(),this.nodes=this.nodes.filter(function(e){return e!==t})},t.prototype.draw=function(t){this.nodes.forEach(function(e){e.neighbours.forEach(function(r){var n=e.pos,i=r.to.pos;t.moveTo(n.x,n.y),t.lineTo(i.x,i.y)})})},t.prototype._connect=function(t,e){var r=this;t.map(function(t){return[new N(e.pos,t.pos),t]}).filter(function(t){var e=t[0];t[1];return!r.polygon.intersectsLine(e)}).filter(function(t){for(var e=t[0],n=(t[1],e.len()),i=e.dir(),o=1;5>o;o++)if(r.polygon.contains(e.a.add(i.scale(o*n/5))))return!0;return!1}).forEach(function(t){var n=(t[0],t[1]);return r.linkNodes(e,n)})},t.fromPolygon=function(e){var r=e.bounds.points.map(function(t){return new F(t)});r=r.concat.apply(r,e.interior.map(function(t){return t.points.map(function(t){return new F(t)})}));var n=new t(r,e);return r.forEach(function(t,e){n._connect(r.slice(e+1),t)}),n},t}(),G=Object.freeze({astar:n,Node:F,Edge:T,VisibilityGraph:B}),H={obs:s,obsCreate:o,Renderer:h,algebra:R,graph:G};return H});